## 인터넷 통신은 어떻게 이루어지는가?

- 클라이언트에서 다른 클라이언트(컴퓨터)로 데이터를 보낼 경우 위치에 따라 위성, 해저광케이블, 기타 통신서버와 같은 인터넷망을 거쳐서 상대 컴퓨터에 도달하게 된다.
- 그런데 인터넷 망은 단순하지 않아, 아래 그림과 같이 수 많은 중간 노드를 거쳐서 서버 컴퓨터에게 도착한다.
- 이렇게 웹 통신 과정이 어떤 규칙으로 목적지까지 안전하게 도착하는지의 이해를 하기 위해 IP, UCP, DNS 프로토콜 지식을 알아야 한다.
  ![스크린샷 2023-08-01 오후 6 10 01](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/9b97df1c-a3db-4dea-bab3-1301f14f76fc)

노드

> 네트워크를 중간에서 연결해주는 서버라고 생각하면 된다. 네트워크의 기본요소인 네트워크에 연결된 컴퓨터와 그 안에 속한 장비들을 통틀어 하나의 노드라고 부르며, 재분배 지점 또는 통신 종단점이다.

## IP (인터넷 프로토콜)

### 아이피 종류

IP(Internet Protocol)란 인터넷에 연결되어 있는 모든 장치들(컴퓨터, 서버장비, 스마트폰 등)을 식별할 수 있도록 각각의 장비에게 부여되는 고유 주소이다.
우리가 다른사람에게 우편물을 보낼 대 국가, 지역, 아파트, 동호수를 정확하게 기재하여 발송하듯이, 네트워크 데이터가 우리에게 도달해 나무위키 같은 홈페이지를 띄우기 위해서는 정확한 주소 정보가 필요하다. 그것이 인터넷 IP 주소이다.
IP주소는 IPv4, IPv6 두가지 종류가 있다. 일반적으로 IP주소라고 하면 IPv4주소를 먼저 말하곤 한다.

### IPv4

IPv4는 IP version 4의 약자로 전 세계적으로 사용된 첫 번째 인터넷 프로토콜이다.
IP는 일반적으로 172.16.254.1와 같이 마침표로 구분된 4개의 숫자가 있는, 점으로 분리된 10진수 형식으로 표시된다.
![스크린샷 2023-08-01 오후 6 15 04](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/0fef1fa0-782f-45a7-b6b4-374dcbf9fa5e)
즉, 아이피는 32bit로 이루어진 주소이며 이를 합산해보면 43억개의 주소를 가지게 된다.

![스크린샷 2023-08-01 오후 6 30 08](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/c0d0ae13-3093-4438-820c-8dc38139273c)

이처럼 IPv4는 0~2^32(약 42억 9천)개의 주소를 가질 수 있지만, 전 세계적으로 인터넷 사용자 수가 급증하면서 IPv4주소가 고갈될 위기에 처해 있다. 이러한 고갈 문제를 해결하기 위해 등장한 주소가 바로 IPv6이다.

### IPv6(최신)

IPv6는 IP version6의 약자로, IPv4의 주소체계를 128비트 크기로 확장한 차세대 인터넷 프로토콜 주소이다. 16bit 8자리로 각 자리는 콜론으로 구분한다.
![스크린샷 2023-08-01 오후 6 32 15](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/72b7baf4-94b3-4217-b965-6179fdd7c6aa)
IPv6의 128비트 주소공간은 128 비트로 표현할 수 잇는 2^128개인 약 3.4x1038(340,282,366,920,938,463,463,374,607,431,768,211,456개)의 주소를 갖고 있어 거의 무한대로 쓸 수 있다.
이처럼 IPv6는 네트워크 속도, 보안적인 부분뿐만 아니라 여러 면에서 뛰어나지만, 기존의 주소체계를 변경하는데 비용이 많이 들어서 아직 완전히 사용화가 되지 않았다.

### IP주소의 고갈 위험.

앞에서 말했듯이 43억개면 충분히 많을 것 같아 보이지만 충분하지 않다.
예전에는 43억정도면 충분하다고 생각했지만, 최근에는 집에 기본적으로 컴퓨터에 와이파이 공유기, 스마트티비, 스위치 등 IP주솔르 할당받은 전자 기기들이 개인 집집마다 여러개를 가지고 있다. 그리고 전세계가 발전함에 따라 점점 인터넷 수요가 늘어나고 있는 실정이다.
결론적으론 이미 43억개의 숫자는 고갈난지 오래이다. 따라서 새로운 주소 체계인 IPv6가 나왔지만 기존의 주소체계를 변경하는데 천문학적인 비용이 들어 아직까지 IPv4를 사용하고 있다.
하지만 고갈되었다면서 주변을 돌아보면 부족한 아이피 할당으로 피해를 보고 있는 곳은 찾아볼 수 없다. 지금까지 문제없이 사용하고 있는 이유는 기존의 주소체계에서 일종의 수학적인 트릭을 고안해서 사용하고 있기 때문이다. 그 트릭이 사설 IP 개념이다.

#### 공인 IP/ 사설 IP/ 고정 IP/ 유동 IP

> 먼저 사설 IP를 알기 전에는 아이피는 4가지로 나뉘어 쓰이는데 IP는 나누는 방식에 따라 고정IP, 유동 IP와 공인IP, 사설 IP로 나눌 수 있다.

#### 고정 IP

고정 IP는 말 그대로 변하지 않고 컴퓨터에 고정적으로 부여된 IP이다.
한번 부여되면 IP반납을 하기 전까지는 다른 장비에 부여할 수 없는 고유의 IP로 보안성이 우수하기 때문에 보안이 필요한 업체나 기관에서 사용한다.

#### 유동 IP

유동 IP역시 말그대로 변하는 IP이다.
인터넷 사용자 모두에게 고정 IP를 부여해 주기에는 힘들기 때문에, 일정한 주기 또는 사용자들이 인터넷에 접속하는 매 순간마다 사용하고 있지 않은 IP주소를 임시로 발급해주는 IP이다.
대부분의 사용자는 유동 IP를 사용한다.

#### 공인 IP

IP 주소는 임의로 우리가 부여하는 것이 아니라 전 세계적으로 ICANN이라는 기관이 국가별로 사용할 IP대역을 관리하고, 우리나라는 한국인터넷진흥원(KISA)에서 국내 IP주소들을 관리하고있다.
이것을 ISP(Internet Service Provider의 약자로 KT, LG, SKT와 같이 인터넷을 제공하는 통신 업체)가 부여받고, 우리는 위 회사의 가입을 통해 IP를 제공받아 인터넷을 사용하게 되는 것이다. 이렇게 발급받은 IP를 공인 IP라고 한다.

#### 사설 IP

공유기를 사용한 인터넷 접속 환경일 경우 공유기까지는 공인 IP할당을 하지만, 공유기에 연결되어 있는 가정이나 회사의 각 네트워크 기기에는 사설 IP를 할당한다.
즉, 사설 IP는 어떤 네트워크 안에서만 내부적으로 사용되는 고유한 주소이다. 사설 IP는 보통 내 컴퓨터에서 사용하는 로컬 IP라고도 불리운다. 공인 IP는 전세계에서 유일하지만, 사설 IP는 하나의 네트워크 안에서 유일하다. 공인 IP는 외부, 내부 상관 없이 해당 IP에 접속할 수 있으나, 사설 IP는 내부에서만 접근이 가능하다.
![스크린샷 2023-08-01 오후 6 45 41](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/9faf3b61-893e-41b5-9157-e3fd0e9e0318)

### 사설 IP & 사설망 원리

사설망이란? 공유기를 사용한 인터넷 접속 환경일 경우 공유기까지는 공인 IP 할당을 하지만, 공유기에 연결되어 있는 가정이나 회사의 각 네트워크 기기에는 사설 IP를 할당하여 그룹으로 묶는 방법이다.
쉽게 비유하자면, 일종의 반장을 뽑는 것과 같다. 학교의 회의에 참여하는데 모든 사람이 참여할 수 없으니 대표 주자인 반장이란걸 뽑는다. 그리고 그 반장은 대표로 나가서 학생들의 의견을 대신 전달하며, 학교 회의 내용을 다시 학생들에게 전달한다. 여기서 반장이 게이트웨이(Gateway)로 비유할 수 있으며 반을 사설망, 학생들은 각 전자기기들, 학교를 인터넷으로 비유하면 된다.

Gateway

> 게이트웨이는 '관문'이나 '출입구'라는 의미로 다양한 분야에서 일반적으로 사용되는 용어이다. 컴퓨터 네트워크에서의 게이트위ㅔ이는 현재 사용자가 위치한 네트워크에서 다른 네트워크로 이동하기 위해 반드시 커쳐야 하는 거점을 의미한다.

사설망 (Private Network)는 지정된 대역의 아이파만 사용가능하다. 리눅스에서 사용하는 10.0.0.0번대의 아이피와, 톰캣이나 아파치 서버를 설치하면서 한번쯤 봤던 192.168.0.0 번대의 아이피가 바로 사설 IP를 일컫는다.
아래 표에 나타난 숫자의 아이피가 있으면 그 아이피는 어느 특정 국가의 지역을 나타내는 인터넷 주소가 아닌 사설 인터넷 주소라고 생각하면 된다.
![스크린샷 2023-08-01 오후 7 02 24](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/e2ef7275-1c16-4389-a7d2-d2bc6294a852)

사설망은 그림으로 표현하면 아래와 같이 표현된다.
![스크린샷 2023-08-01 오후 7 02 55](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/00ff0bba-5940-431d-bb4f-38557f894c19)

반 : 사설망
반장 : Gateway (192.168.0.1 <-> 181.227.3.33)
반 학생들 : 각 컴퓨터들 (192.168.0.2, 192.168.0.3, 192.168.0.4 ...)
학교 : 외부 인터넷 (61.123.44.1)

사설망(반) 안에서 학생(컴퓨터)들은 유니크 하다. 학창시절을 떠올려보면, 반마다 학생번호를 부여하는데 2학년 1반의 10번 학생과 2학년 2반의 10번 학생은 서로 전혀 다른 사람이다. 보기에는 부여받은 10번은 같지만 2학년 1반, 2반을 통해 10번을 구분할 수 있다. 이 개념이 바로 사설망 개념이다.

사설 IP(로컬 IP)는 어떤 네트워크 안에서 내부적으로 사용되는 고유한 주소이다. 따라서 건국대학교 안에서 사용하는 192.168.10.2 아이피와 숭실대학교 안에서 사용하는 192.168.10.2 아이피는 번호는 같을지언정 전혀 다른 목적지 주소를 나타내게 된다. 그리고 같은 번호 아이피를 구분하는 수단은 2학년 1반 처럼 외부에서 할당받은 전 세계에서 유일한 공인IP(181.277.3.33)로 구분한다.

이처럼 사설망이라는 개념을 쓰면 같은 아이피 번호를 중복해서 마구 사용할수 있고, 이는 곧 IP의 절약과 연관된다.

### NAT (사설망 <-> 외부 통신 방법)

그러면 사설망 안에 있는 컴퓨터는 어떻게 외부와 통신할까?
외부 인터넷 입장에서 주소 번호가 똑같은 사설 IP들을 어떻게 각각을 특정해 정확히 찾아들어가 우리에게 웹 페이지를 띄울 수 있는 것일까?
여기서 바로 NAT(Network Adress Translation)이란 개념이 등장한다. 이름에서 알 수 있듯이 인터넷 주소 번역 기능이다.
![스크린샷 2023-08-01 오후 7 14 55](https://github.com/mandoo1229/React-Board-Restart/assets/123732776/1daf252a-7cf7-464c-a1e5-d936b58b681d)
인터넷 주소 변역 원리는 간단하다. 우선 공유기(라우터)에 연결되어 있는 각 사내 컴퓨터들의 사설 IP(192/168.0.xxx)를 받아와 유일한 공인 IP로 변환한다. 그리고 외부 인터넷으로 공인 IP 주소정보를 보내는 것이다.
외부 입장에서는 어느 회사의 영업부 사원이 보냈는지 알지 못한다. 그냥 회사 공유기 주소만 알고 잇는 것이다. 하지만 문제는 없다. 답변을 하게 되면, 인터넷 정보가 다시 회사 공유기로 올 것이고, 공유기에서는 이전에 요청한 정보들을 다 기억하고 있어서, 확인하고 그대로 김인턴 PC에게 넘겨주는 것이다.
즉, private ip를 사용하고 잇는 컴퓨터가 사설 밖에 있는 public ip에 해당되는 외부세계에 간접적이라도 접속할 수 있게 된다. 이때 사용되는 기술이 바로 NAT인 것이다.

### NAT(Network Address Translation)개념

네트워크 주소 변환(network address translation)은 컴퓨터 네트워킹에서 쓰이는 용어로서, IP패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP주소 등을 재기록하면서 라우터를 통해 네트워크 트래픽을 주고 받는 기술을 말한다. 한 마디로 Network Address인 IP를 변환하겠다는 뜻이다. NAT를 이용하는 이유는 대게 사설 네트워크(Private Network)에 속한 여러 개의 호스트가 하나의 공인 IP주소를 사용하여 인터넷 접속하기 위함이다. IP주소에는 Public IP(공인 IP) 와 Private IP(사설 IP)가 있다. IP를 굳이 두 종류로 나눈 이유를 간단히 말하자면 IPv4 주소의 낭비를 막고 공인 인터넷을 굳이 사용하지 않아도 되는 단말들에게 어느 망이든 중복 사용 가능한 IP를 주기 위함이다.

#### Private Network에서 사용 가능한 Private IP(사설 IP)

> 10.0.0.0 ~ 10.255.255.255
> 172.16.0.0 ~ 172.31.255.255
> 192.168.0.0 ~ 192.168.255.255

공인 인터넷망과 컴퓨터 사이에는 내 컴퓨터에게 IP를 할당해주는 공유기가 있다. 그리고 공유기는 공인 IP를 보유하며 인터넷과 맞닿아있다.
Private IP뿐인 내 컴퓨터가 외부 서비스(8.8.8.8)을 사용하고자 공유기로 나아가면, 공유기는 Private IP뿐인 내 컴퓨터이 IP를 공유기 자신의 공인 IP로 변환하게 된다. 즉 공유기를 지나 외부 인터넷으로 나아갈 때에는 공유기의 공인 IP를 가지고 원하는 Destination Address로 향하는 것이다.
